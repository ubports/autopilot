#!/usr/bin/make -f
# -*- makefile -*-

# Uncomment this to turn on verbose mode.
# export DH_VERBOSE=1

%:
	dh $@ --with python3 --buildsystem=pybuild

override_dh_installdocs:
	python3 setup.py build_sphinx -b html
	python3 setup.py build_sphinx -b man
	dh_installdocs
	rm -f debian/python3-autopilot/usr/share/doc/python3-autopilot/html/_static/jquery.js
	ln -s /usr/share/javascript/jquery/jquery.js \
	      debian/python3-autopilot/usr/share/doc/python3-autopilot/html/_static/jquery.js
	rm -f debian/python3-autopilot/usr/share/doc/python3-autopilot/html/_static/underscore.js
	ln -s /usr/share/javascript/underscore/underscore.js \
	      debian/python3-autopilot/usr/share/doc/python3-autopilot/html/_static/underscore.js

override_dh_auto_test:
ifeq (, $(findstring nocheck, $(DEB_BUILD_OPTIONS)))
	HOME=`mktemp -d --tmpdir=debian` \
	python3 -m testtools.run discover autopilot.tests.unit
endif
